<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cesium Flight Tracker (CDN / å®Œæˆç‰ˆ)</title>

  <!-- CesiumJSï¼ˆCDNï¼‰ -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.115/Build/Cesium/Cesium.js"></script>
  <link rel="stylesheet" href="https://cesium.com/downloads/cesiumjs/releases/1.115/Build/Cesium/Widgets/widgets.css" />

  <style>
    html, body, #cesiumContainer { width:100%; height:100%; margin:0; padding:0; overflow:hidden; }
    .panel {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(20,20,20,0.75);
      color: #fff;
      padding: 10px 12px;
      border-radius: 10px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-size: 13px;
      line-height: 1.4;
      max-width: 340px;
    }
    .panel h1 { font-size: 14px; margin: 0 0 6px; }
    .row { display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap; }
    button, input[type="range"] {
      font: inherit;
    }
    button {
      padding: 6px 10px;
      border: 0;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn { background:#2b6cb0; color:#fff; }
    .btn2 { background:#4a5568; color:#fff; }
    .badge { opacity:.9; font-size:12px; }
    a { color:#9ae6b4; }
    code { background: rgba(255,255,255,0.08); padding: 1px 4px; border-radius: 6px; }
  </style>
</head>

<body>
  <div id="cesiumContainer"></div>

  <div class="panel">
    <h1>âœˆï¸ Flight Trackerï¼ˆãƒ‡ãƒ¢ / åŸ‹ã‚è¾¼ã¿é£›è¡Œãƒ‡ãƒ¼ã‚¿ï¼‰</h1>
    <div class="badge">
      ãƒ»ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®HTMLå†…ã«åŸ‹ã‚è¾¼ã¿ï¼ˆé€šä¿¡ãªã—ï¼‰<br/>
      ãƒ»ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³/ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§å†ç”Ÿã§ãã¾ã™
    </div>

    <div class="row">
      <button id="btnPlay" class="btn">â–¶ å†ç”Ÿ</button>
      <button id="btnPause" class="btn2">â¸ åœæ­¢</button>
      <button id="btnReset" class="btn2">â†© æœ€åˆã¸</button>
      <button id="btnFollow" class="btn2">ğŸ¥ è¿½å°¾ON</button>
    </div>

    <div class="row" style="margin-top:10px;">
      <label for="speed">é€Ÿåº¦ï¼š</label>
      <input id="speed" type="range" min="1" max="200" value="30" />
      <span id="speedVal">30Ã—</span>
    </div>

    <div class="row" style="margin-top:10px;">
      <span>ãƒ’ãƒ³ãƒˆï¼š</span>
      <span>ãƒˆãƒ¼ã‚¯ãƒ³ã¯ <code>Cesium.Ion.defaultAccessToken</code> ã«è²¼ã‚Šä»˜ã‘</span>
    </div>
  </div>

  <script>
    // =========================
    // 1) ã“ã“ã«è‡ªåˆ†ã® Cesium ion ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è²¼ã‚‹
    // =========================
    Cesium.Ion.defaultAccessToken = "ã“ã“ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è²¼ã‚‹";

    // =========================
    // 2) Viewer ã‚’ä½œã‚‹
    // =========================
    const viewer = new Cesium.Viewer("cesiumContainer", {
      terrain: Cesium.Terrain.fromWorldTerrain(),
      timeline: true,
      animation: true,
      shouldAnimate: true
    });

    // 3Då»ºç‰©ï¼ˆãŠå¥½ã¿ï¼‰
    viewer.scene.primitives.add(Cesium.createOsmBuildings());

    // =========================
    // 3) é£›è¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆæ™‚ç³»åˆ—ï¼‰ã‚’ â€œåŸ‹ã‚è¾¼ã¿â€ ã§ç”¨æ„
    //    ä¾‹ï¼šä»™å°ä»˜è¿‘ â†’ æ±äº¬ä»˜è¿‘ã¸ï¼ˆç´„10åˆ†åˆ†ã®ãƒ‡ãƒ¢ï¼‰
    // =========================
    // æ™‚åˆ»ï¼ˆUTCï¼‰ã‚’ä½¿ã†ï¼šISOæ–‡å­—åˆ—ã§æ›¸ãã®ãŒåˆ†ã‹ã‚Šã‚„ã™ã„
    const t0 = "2026-01-19T00:00:00Z"; // ãƒ‡ãƒ¢é–‹å§‹æ™‚åˆ»
    const samples = [
      // time, lon, lat, alt(m)
      ["2026-01-19T00:00:00Z", 141.154, 38.268, 1200],
      ["2026-01-19T00:01:00Z", 141.050, 38.150, 2200],
      ["2026-01-19T00:02:00Z", 140.930, 38.000, 3800],
      ["2026-01-19T00:03:00Z", 140.780, 37.820, 5200],
      ["2026-01-19T00:04:00Z", 140.580, 37.620, 6800],
      ["2026-01-19T00:05:00Z", 140.330, 37.360, 8200],
      ["2026-01-19T00:06:00Z", 140.060, 37.070, 9100],
      ["2026-01-19T00:07:00Z", 139.880, 36.780, 9800],
      ["2026-01-19T00:08:00Z", 139.800, 36.420, 9800],
      ["2026-01-19T00:09:00Z", 139.770, 36.050, 9000],
      ["2026-01-19T00:10:00Z", 139.770, 35.681, 3000]
    ];

    // =========================
    // 4) SampledPositionProperty ã«å¤‰æ›ï¼ˆFlight Trackerã®åŸºæœ¬ï¼‰
    // =========================
    const position = new Cesium.SampledPositionProperty();
    for (const s of samples) {
      const time = Cesium.JulianDate.fromIso8601(s[0]);
      const p = Cesium.Cartesian3.fromDegrees(s[1], s[2], s[3]);
      position.addSample(time, p);
    }

    // è£œé–“ï¼ˆæ»‘ã‚‰ã‹ã«å‹•ãï¼‰
    position.setInterpolationOptions({
      interpolationDegree: 2,
      interpolationAlgorithm: Cesium.LagrangePolynomialApproximation
    });

    // =========================
    // 5) è¡¨ç¤ºã™ã‚‹ã€Œé£›è¡Œæ©Ÿï¼ˆç‚¹ï¼‹ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã€ã¨ã€Œè»Œè·¡ï¼ˆPathï¼‰ã€ã‚’ä½œã‚‹
    // =========================
    // ã‚·ãƒ³ãƒ—ãƒ«ãªé£›è¡Œæ©ŸSVGï¼ˆdata URLï¼‰â€¦å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦
    const airplaneSvg = `
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64">
        <path fill="white" d="M62 34l-20 6-10 22-4-1 6-22-14-4-8 8-4-1 6-12-6-12 4-1 8 8 14-4-6-22 4-1 10 22 20 6z"/>
      </svg>
    `;
    const airplaneUrl = "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(airplaneSvg);

    const start = Cesium.JulianDate.fromIso8601(samples[0][0]);
    const stop  = Cesium.JulianDate.fromIso8601(samples[samples.length - 1][0]);

    // é‡è¦ï¼šã‚¯ãƒ­ãƒƒã‚¯è¨­å®šï¼ˆã“ã®æ™‚é–“å¸¯ã ã‘å†ç”Ÿï¼‰
    viewer.clock.startTime = start.clone();
    viewer.clock.stopTime  = stop.clone();
    viewer.clock.currentTime = start.clone();
    viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP; // æœ€å¾Œã¾ã§è¡Œã£ãŸã‚‰æ­¢ã‚ã‚‹
    viewer.clock.multiplier = 30; // å†ç”Ÿé€Ÿåº¦ï¼ˆUIã§å¤‰ãˆã‚‹ï¼‰

    // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®è¡¨ç¤ºç¯„å›²ã‚‚åˆã‚ã›ã‚‹
    viewer.timeline.zoomTo(start, stop);

    // é£›è¡Œæ©Ÿã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
    const plane = viewer.entities.add({
      name: "Demo Flight",
      availability: new Cesium.TimeIntervalCollection([
        new Cesium.TimeInterval({ start, stop })
      ]),
      position,
      orientation: new Cesium.VelocityOrientationProperty(position), // é€²è¡Œæ–¹å‘ã«å‘ã‘ã‚‹
      billboard: {
        image: airplaneUrl,
        scale: 0.7,
        verticalOrigin: Cesium.VerticalOrigin.CENTER,
        alignedAxis: Cesium.Cartesian3.ZERO
      },
      path: {
        show: true,
        width: 3,
        leadTime: 0,          // å…ˆè¡Œã¯æã‹ãªã„
        trailTime: 600,       // éå»10åˆ†åˆ†ã‚’è¡¨ç¤ºï¼ˆç§’ï¼‰
        resolution: 5
      },
      label: {
        text: "Demo Flight",
        font: "14px sans-serif",
        pixelOffset: new Cesium.Cartesian2(0, -40),
        fillColor: Cesium.Color.WHITE,
        outlineColor: Cesium.Color.BLACK,
        outlineWidth: 2,
        showBackground: true,
        backgroundColor: new Cesium.Color(0, 0, 0, 0.5)
      }
    });

    // æœ€åˆã«é£›è¡Œæ©ŸãŒè¦‹ãˆã‚‹ã‚ˆã†ã«
    viewer.trackedEntity = plane; // è¿½å°¾ONã§é–‹å§‹
    let following = true;

    // =========================
    // 6) UIï¼ˆå†ç”Ÿ/åœæ­¢/æœ€åˆã¸/è¿½å°¾ã€é€Ÿåº¦ï¼‰
    // =========================
    const btnPlay = document.getElementById("btnPlay");
    const btnPause = document.getElementById("btnPause");
    const btnReset = document.getElementById("btnReset");
    const btnFollow = document.getElementById("btnFollow");
    const speed = document.getElementById("speed");
    const speedVal = document.getElementById("speedVal");

    btnPlay.onclick = () => { viewer.clock.shouldAnimate = true; };
    btnPause.onclick = () => { viewer.clock.shouldAnimate = false; };

    btnReset.onclick = () => {
      viewer.clock.currentTime = start.clone();
      viewer.clock.shouldAnimate = false;
      if (following) viewer.trackedEntity = plane;
    };

    btnFollow.onclick = () => {
      following = !following;
      btnFollow.textContent = following ? "ğŸ¥ è¿½å°¾ON" : "ğŸ¥ è¿½å°¾OFF";
      viewer.trackedEntity = following ? plane : undefined;
    };

    speed.oninput = () => {
      const v = Number(speed.value);
      viewer.clock.multiplier = v;
      speedVal.textContent = `${v}Ã—`;
    };
    // åˆæœŸå€¤è¡¨ç¤º
    speedVal.textContent = `${viewer.clock.multiplier}Ã—`;
    speed.value = String(viewer.clock.multiplier);

    // =========================
    // 7) ã¡ã‚‡ã„ä¾¿åˆ©ï¼šã‚¯ãƒªãƒƒã‚¯ã§æƒ…å ±è¡¨ç¤º
    // =========================
    plane.description = `
      <h3>Demo Flight</h3>
      <p>ã“ã®é£›è¡Œã¯ <b>HTMLå†…ã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿</b>ã§å‹•ã„ã¦ã„ã¾ã™ã€‚</p>
      <p>æ¬¡ã¯ã€ã‚ãªãŸã®å®Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆCSV/CZML/JSONï¼‰ã«å·®ã—æ›¿ãˆå¯èƒ½ã§ã™ã€‚</p>
    `;
  </script>
</body>
</html>
